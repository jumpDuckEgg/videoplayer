import e from"events";import{pushScopeId as t,popScopeId as s,withDirectives as i,openBlock as o,createElementBlock as n,createElementVNode as r,normalizeStyle as l,vShow as a,normalizeClass as c,resolveComponent as d,resolveDirective as u,withModifiers as h,renderSlot as g,toDisplayString as p,createVNode as v,createBlock as m,createCommentVNode as y}from"vue";var f,b={exports:{}};
/*!
* screenfull
* v5.1.0 - 2020-12-24
* (c) Sindre Sorhus; MIT License
*/f=b,function(){var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},t=f.exports,s=function(){for(var t,s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,o=s.length,n={};i<o;i++)if((t=s[i])&&t[1]in e){for(i=0;i<t.length;i++)n[s[0][i]]=t[i];return n}return!1}(),i={change:s.fullscreenchange,error:s.fullscreenerror},o={request:function(t,i){return new Promise(function(o,n){var r=function(){this.off("change",r),o()}.bind(this);this.on("change",r);var l=(t=t||e.documentElement)[s.requestFullscreen](i);l instanceof Promise&&l.then(r).catch(n)}.bind(this))},exit:function(){return new Promise(function(t,i){if(this.isFullscreen){var o=function(){this.off("change",o),t()}.bind(this);this.on("change",o);var n=e[s.exitFullscreen]();n instanceof Promise&&n.then(o).catch(i)}else t()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(t,s){var o=i[t];o&&e.addEventListener(o,s,!1)},off:function(t,s){var o=i[t];o&&e.removeEventListener(o,s,!1)},raw:s};s?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(e[s.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[s.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[s.fullscreenEnabled])}}}),t?f.exports=o:window.screenfull=o):t?f.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}();var w=b.exports;function C(e,t=[]){return e instanceof HTMLElement?"BODY"!==e.parentElement.nodeName?(t.push(e.parentElement),C(e.parentElement,t)):t:console.error("receive only HTMLElement")}const _={isMamaApp(){const e=window.navigator.userAgent;return/mmq/i.test(e)||/gzq/i.test(e)||/pregnancyhelper/i.test(e)||/recordapp/i.test(e)||/mmgoods/i.test(e)},fullscreen(e,t){w.isEnabled?w.request(t):t.webkitSupportsFullscreen?t.webkitEnterFullscreen():this.addClass(e,"video-player--is-cssfullscreen")},exitFullscreen(){w.exit()},checkFullEnabled(){let e=document.fullscreenEnabled||window.fullScreen||document.webkitIsFullScreen||document.msFullscreenEnabled;return void 0===e&&(e=!1),e},addClass(e,t){e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((t=>{t&&e.classList.add(t)})):_.hasClass(e,t)||(e.className+=` ${t}`)},removeClass(e,t){e.classList?t.split(/\s+/g).forEach((t=>{e.classList.remove(t)})):_.hasClass(e,t)&&t.split(/\s+/g).forEach((t=>{const s=new RegExp(`(\\s|^)${t}(\\s|$)`);e.className=e.className.replace(s," ")}))},createDom(e="div",t="",s={},i=""){const o=document.createElement(e);return o.className=i,o.innerHTML=t,Object.keys(s).forEach((t=>{const i=t,n=s[t];if("video"===e||"audio"===e)if("style"===i)for(const e in n)o.style[e]=n[e];else o.setAttribute(i,n)})),o},hasClass:(e,t)=>e.classList?Array.prototype.some.call(e.classList,(e=>e===t)):Boolean(e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))),deepCopy(e,t){if("Object"===_.typeOf(t)&&"Object"===_.typeOf(e))return Object.keys(t).forEach((s=>{"Object"!==_.typeOf(t[s])||t[s]instanceof Node?"Array"===_.typeOf(t[s])?e[s]="Array"===_.typeOf(e[s])?e[s].concat(t[s]):t[s]:e[s]=t[s]:e[s]?_.deepCopy(e[s],t[s]):e[s]=t[s]})),e},typeOf:e=>Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0],...{isWeixin(){const e=navigator.userAgent.toLowerCase();return-1!==Number(e.indexOf("micromessenger"))},isIOS(){const e=navigator.userAgent;return Boolean(e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/))},isAndroid:()=>window.navigator.userAgent.indexOf("Android")>-1,get isAndroidX5SupportInlinePlayer(){const e=window.navigator.userAgent,t=e.match(/TBS\/([\d.]+)/),s={tbsWx:"micromessenger"===e.match(/MicroMessenger/i)&&t&&t[1]>=36849,MQQBrowser:e.match(/MQQBrowser\/([\d.]+)/)&&e.match(/MQQBrowser\/([\d.]+)/)[1]>=7.2,tbsX5:t&&t[1]>=36900&&-1===[{type:"vivo",tbs:44328}].findIndex((e=>e.tbs===t[1]))};return(e.indexOf("Android")>-1||e.indexOf("Linux")>-1)&&(s.tbsWx||s.tbsQQ||s.MQQBrowser||s.tbsX5)},get isNeedToAdjustAndroidX5SupportInlinePlayerStyle(){const e=window.navigator.userAgent.match(/TBS\/([\d.]+)/),t=e&&e[1]||0;return this.isAndroidX5SupportInlinePlayer&&t<=45200}}},{createDom:P,isAndroidX5SupportInlinePlayer:S}=_;let F=[];const B=new Map;class E extends e{constructor(e={}){super();this.config=this.videoConfig=Object.assign({},{autoplay:!1,muted:!0,autoplayMuted:!0,id:"video"},e),this.$videoContainer=document.getElementById(`Container${this.videoConfig.id}`);let t={"x5-video-player-type":"h5-page",class:"video-player__main__tech",id:e.id,style:Object.assign({},e.style,{width:"100%",height:"100%"})};t=e.isPlaysinline?Object.assign({},t,{playsinline:!0,"webkit-playsinline":!0}):Object.assign({},t,{"x5-video-player-fullscree":!0,"x5-video-orientation":"landscape|portrait"}),e.autoplay&&(t=Object.assign({},t,{muted:"muted",autoplay:e.autoplay})),e.loop&&(t=Object.assign({},t,{loop:!0})),this.video=P("video","",t,""),this.pluginsCall(),this.videoConfig.reload&&this.switchURL&&this.switchURL(this.videoConfig.url),B.set(this.videoConfig.id,this),F.push(this.videoConfig.id),this.start()}async start(e=this.config.url){this.config.autoplay&&this.on("canplay",(()=>{console.log("设置了自动播放了哦"),this.checkCanAutoPlay().then((({canAutoPlay:e})=>{console.log(e)})).catch((({canAutoPlay:e})=>{console.log(e)}))})),this.ev=["play","playing","pause","ended","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","progress","autoplay","error","loadstart"].map((e=>({[e]:`on${e.charAt(0).toUpperCase()}${e.slice(1)}`}))),this.ev.forEach((e=>{const t=Object.keys(e)[0],s=this.videoConfig[e[t]];s&&this.on(t,s)}));const t=this;this.ev.forEach((e=>{t.evItem=Object.keys(e)[0];const s=Object.keys(e)[0];t.video.addEventListener(s,(function(){t.emit(s,t)}),!1)})),"String"===_.typeOf(e)&&(this.video.src=e),this.$videoContainer.appendChild(this.video)}get isAndroidX5SupportInlinePlayer(){return S}get playerUrl(){return this.videoConfig.src}get isAutoPlay(){return this.videoConfig.autoplay}get volume(){return this.video.volume}set volume(e){this.video.volume=e}get muted(){return this.video.muted}set muted(e){this.video.muted=e}get duration(){return this.video.duration}get isPaused(){return this.video.paused}set autoplay(e){this.video.autoplay=e}get autoplay(){return this.video.autoplay}get buffered(){return this.video.buffered}get crossOrigin(){return this.video.crossOrigin}set crossOrigin(e){this.video.crossOrigin=e}get currentTime(){return this.video.currentTime}set currentTime(e){isFinite(e)&&(this.video.currentTime=e)}get defaultMuted(){return this.video.defaultMuted}set defaultMuted(e){this.video.defaultMuted=e}get src(){return this.video.src}set src(e){this.video.pause(),this.video.src=e}async checkCanAutoPlay(){let e=!1;return new Promise(((t,s)=>{if(_.isWeixin()&&_.isIOS())document.addEventListener("WeixinJSBridgeReady",(()=>{try{this.video.play(),this.emit("autoplay",this.videoConfig.onAutoplay),t({canAutoPlay:!0})}catch(e){console.log(e),t({canAutoPlay:!1})}}),!1);else{const i=this.video.play();void 0!==i&&i&&i.catch((()=>{console.log(" Auto-play was prevented"),e=!1,s({canAutoPlay:e})})).then((()=>{e=!0,this.wxReady(),e&&(console.log("能够自动播放哦！"),this.play()),this.emit("autoplay",this.videoConfig.onAutoplay),t({canAutoPlay:e})}))}}))}wxReady(){document.addEventListener("WeixinJSBridgeReady",(()=>{this.play()}),!1)}play(){this.video.play()?.catch((e=>{console.log(e)})),setTimeout((()=>{F.filter((e=>e!==this.videoConfig.id)).forEach((e=>{console.log(B.get(e).video),B.get(e).video.pause()}))}),200)}load(){F.forEach((e=>{B.get(e).video.load()}))}pause(){this.video.pause()}destroy(){this.emit("destroy");const e=this;this.video&&this.video.pause(),this.ev.forEach((e=>{const t=Object.keys(e)[0],s=this.videoConfig[e[t]];s&&this.off(t,s)})),this.ev.forEach((t=>{this.evItem=Object.keys(t)[0];const s=Object.keys(t)[0];this.video.removeEventListener(s,(function(){this.off(s,e)}))})),document.getElementById(this.videoConfig.id)&&this.$videoContainer.removeChild(this.video),B.delete(this.video.id),F=F.filter((e=>e!==this.video.id))}getBufferedRange(){const e=[0,0],t=this.video,s=t.buffered,i=t.currentTime;if(s)for(let t=0,o=s.length;t<o&&(e[0]=s.start(t),e[1]=s.end(t),!(e[0]<=i&&i<=e[1]));t++);return e[0]-i<=0&&i-e[1]<=0?e:[0,0]}pluginsCall(){E.plugins&&Object.keys(E.plugins).forEach((e=>{E.plugins[e].call(this,this)}))}static install(e,t){E.plugins||(E.plugins={}),E.plugins[e]=t}}E.util=_;var T={bind:function(e,t,s){if("function"!=typeof t.value){const e=s.context.name;let i=`[longpress:] provided expression '${t.expression}' is not a function, but has to be `;e&&(i+=`Found in component '${e}' `),console.warn(i)}let i=null;const o=e=>{"click"===e.type&&0!==e.button||null===i&&(i=setTimeout((()=>{r()}),600))},n=e=>{"click"===e.type&&e.preventDefault(),null!==i&&(clearTimeout(i),i=null)},r=e=>{t.value(e)};e.addEventListener("mousedown",o),e.addEventListener("touchstart",o),e.addEventListener("click",n),e.addEventListener("mouseup",n),e.addEventListener("mouseout",n),e.addEventListener("touchend",n),e.addEventListener("touchcancel",n)}},x={props:{isShow:{default:!1,type:Boolean},volume:{type:Number,default:1},isFullscreen:{type:Boolean,default:!1},cssFullscreen:{type:Boolean,default:!1},isCrossScreen:{type:Boolean,default:!1}},data:()=>({percentage:0,barX:0,barWidth:0,showVolume:!0}),watch:{isShow:{handler(e){this.showVolume=e}},isFullscreen(e){this.showVolume=!0,this.$nextTick((()=>{e&&this.cssFullscreen&&this.isCrossScreen?(console.log("after",this.$refs.volumeWarpper.getBoundingClientRect()),this.barX=this.$refs.volumeWarpper.getBoundingClientRect().y,this.barWidth=this.$refs.volumeWarpper.getBoundingClientRect().height):(this.barX=this.$refs.volumeWarpper.getBoundingClientRect().x,this.barWidth=this.$refs.volumeWarpper.getBoundingClientRect().width),this.showVolume=this.isShow}))}},mounted(){this.$refs.volumeWarpper&&(this.initBar(),this.showVolume=this.isShow)},methods:{initBar(){this.isFullscreen&&this.cssFullscreen&&this.isCrossScreen?(this.barX=this.$refs.volumeWarpper.getBoundingClientRect().y,this.barWidth=this.$refs.volumeWarpper.getBoundingClientRect().height):(this.barX=this.$refs.volumeWarpper.getBoundingClientRect().x,this.barWidth=this.$refs.volumeWarpper.getBoundingClientRect().width)},updateByPercentage(e){this.percentage=e,this.$emit("update:volume",e)},getPercentageByTouchX(e){const t=Math.floor((e-this.barX)/this.barWidth*100);return t<=0?0:t>=100?100:t},touchstart(e){this.controlTouch(e)},touchmove(e){this.controlTouch(e)},controlTouch(e){const t=this.isFullscreen&&this.cssFullscreen&&this.isCrossScreen?e.touches[0].clientY:e.touches[0].clientX;this.percentage=this.getPercentageByTouchX(t)/100,this.updateByPercentage(this.percentage)},click(e){const t=this.isFullscreen&&this.cssFullscreen&&this.isCrossScreen?e.clientY:e.clientX;this.percentage=this.getPercentageByTouchX(t)/100,this.updateByPercentage(this.percentage)}}};t("data-v-7dd6d4c3");const k={class:"volume-control"},$=[r("span",{class:"volume-control__inner__dot"},null,-1)];s(),x.render=function(e,t,s,c,d,u){return i((o(),n("div",{ref:"volumeWarpper",class:"video-player__controls__volume__control",onTouchstart:t[0]||(t[0]=(...e)=>u.touchstart&&u.touchstart(...e)),onTouchmove:t[1]||(t[1]=(...e)=>u.touchmove&&u.touchmove(...e)),onClick:t[2]||(t[2]=(...e)=>u.click&&u.click(...e))},[r("div",k,[r("div",{class:"volume-control__inner",style:l({width:100*s.volume+"%"})},$,4)])],544)),[[a,d.showVolume]])},x.__scopeId="data-v-7dd6d4c3",x.__file="src/volume-control.vue";var W={props:{color:{type:String,default:"#fff"}}};const O={class:"video-player__loading"},A={xmlns:"http://www.w3.org/2000/svg",width:"100",height:"100",viewBox:"0 0 100 100"},M=[r("animateTransform",{attributeType:"xml",attributeName:"transform",type:"rotate",from:"0 50 50",to:"360 50 50",dur:"1s",repeatCount:"indefinite"},null,-1)];W.render=function(e,t,s,i,a,c){return o(),n("div",O,[(o(),n("svg",A,[r("path",{d:"M100 50,A50 50, 0 1 1, 50,0",style:l({stroke:s.color})},M,4)]))])},W.__file="src/loading.vue";var X={components:{},props:{percentage:{type:Number,default:0},loadPercentage:{type:Number,default:0},themeColor:{type:String,default:"#ff98be"},isShow:{type:Boolean,default:!1}}};t("data-v-ba3040d6");const I=[r("div",{class:"bottom-controls-bar__played__dot"},null,-1)];s(),X.render=function(e,t,s,i,a,d){return o(),n("div",{class:c(["bottom-controls-bar",s.isShow?"":"hidden"])},[r("div",{class:"bottom-controls-bar__load",style:l({width:`${s.loadPercentage}%`})},null,4),r("div",{class:"bottom-controls-bar__played",style:l({width:`${s.percentage}%`,background:`${s.themeColor}`})},I,4)],2)},X.__scopeId="data-v-ba3040d6",X.__file="src/bottom-controls-bar.vue";const{isNeedToAdjustAndroidX5SupportInlinePlayerStyle:L}=_;var R={name:"videoPlayer",components:{volumeControl:x,loading:W,bottomBar:X},directives:{longpress:T},filters:{timeFormatter(e){const t=e=>e>9?e:`0${e}`;if(Number.isNaN(e))return"00:00";const s=Math.floor(e%60);return`${t(Math.floor(e/60))}:${t(s)}`}},props:{mreport:{type:Object,default:()=>({})},durationProperties:{type:Object,default:()=>({})},url:{type:[String],default:"",required:!0},poster:{type:[String],default:"",required:!0},controlPlayBtn:{type:[String],default:"//static-files.cdnmama.com/bifang/comp-video-play-view-1/image/icon-play.png"},autoPlay:{type:Boolean,default:!1},width:{type:[String],default:"750px"},height:{type:[String],default:"750px"},objectFit:{type:String,default:"contain"},controls:{type:Boolean,default:!1},themeColor:{type:String,default:"#ff98be"},muted:{type:Boolean,default:!1},cssFullscreen:{type:Boolean,default:!0},horizontal:{type:Boolean,default:!1},isBottomBar:{type:Boolean,default:!1},isCrossScreen:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},isPlaysinline:{type:Boolean,default:!0}},data(){return{viewsNum:0,isPlaying:!1,isX5Android:L,isX5Horizontal:L&&this.horizontal,isLoading:!1,waitTimer:null,isReportVideoView:!1,voted:!1,vId:`${Date.now().toString(36)}`,isPlayed:!1,status:"",video:null,currentTime:0,duration:0,isSeeking:!1,percentage:0,barX:0,barWidth:0,isControl:!1,controlTimer:null,isWaiting:!1,loadPercentage:0,isMuted:this.muted,isShowVolume:!1,volume:0,isFullscreen:!1,isFirstPlayed:!0,bodyHeight:0,bodyWidth:0,crossScreenStyle:{},isEnded:!0}},watch:{url(){this.destroy(),this.$nextTick((()=>{this.initVideo(!0)}))},muted:{handler(e){this.updateMuted(e)}},volume:{handler(e){this.updateVolume(e)}},isFullscreen(e){this.cssFullscreen&&(e?this.resovleParentSettedTransformCauseChirldNodeInvalidFixed():this.resetParentStyle()),this.$emit("fullscreenChange",e)},controls(e){e?this.toggleControl():this.isControl=!1}},mounted(){(this.isX5Android||this.autoPlay)&&(this.initVideo(),this.isControl=!1),this.videoWidth=`${this.$refs.playerContainer.offsetWidth}px`,this.videoHeight=`${this.$refs.playerContainer.offsetHeight}px`,this.$refs.progress&&this.initBar(),this.crossScreenStyle={width:`${window.innerHeight}px`,height:`${window.innerWidth}px`}},destroyed(){this.video&&this.video.destroy()},methods:{initBar(){this.isFullscreen&&this.cssFullscreen&&this.isCrossScreen?(this.barX=this.$refs.progress.getBoundingClientRect().y,this.barWidth=this.$refs.progress.getBoundingClientRect().height):(this.barX=this.$refs.progress.getBoundingClientRect().x,this.barWidth=this.$refs.progress.getBoundingClientRect().width)},onfullscreenEvents(){w.isEnabled&&w.on("change",(()=>{w.isFullscreen||(this.isFullscreen=!this.isFullscreen)}))},initVideo(e=!1){if(this.video&&!e)return;this.isPlayed=!1,this.isPlaying=!1,this.isControl=!1,this.isFirstPlayed=!0,this.video=null;const t=this;this.$refs.progress&&(this.barX=this.$refs.progress.getBoundingClientRect().x,this.barWidth=this.$refs.progress.getBoundingClientRect().width),this.isWaiting=!0,this.video=new E({id:this.vId,autoplay:this.autoPlay,loop:this.loop,url:this.url,isPlaysinline:this.isPlaysinline,style:{objectFit:this.objectFit},reload:e,muted:this.isMuted,onTimeupdate:function(e){t.status="onTimeupdate",e.currentTime<=0&&(this.isWaiting=!0),this.isSeeking||(t.duration=e.duration,t.currentTime=e.currentTime,t.updateByPercentage(t.currentTime/t.duration*100)),t.$emit("videoTimeupdate",e.currentTime)},onPlaying:function(){t.status="onPlaying",console.log("onPlaying"),t.isWaiting=!1,t.showControl()},onEnded:function(e){t.status="结束啦",t.isPlaying=!1,t.fixShowControl(),t.$emit("videoEnded",e),t.isEnded=!0,console.log("onEnded")},onPause:function(e){t.status="暂停",t.isPlaying=!1,t.currentTime||_.isIOS()||!_.isWeixin()?t.fixShowControl():t.isPlayed=!1,t.$emit("videoPause",e)},onPlay:function(e){t.status="播放了",console.log("onPlay"),t.isWaiting=!1,t.isPlaying=!0,t.isPlayed=!0,t.isFirstPlayed&&(t.isFirstPlayed=!1),t.showControl(),t.$emit("videoPlay",e)},onLoadeddata:function(e){t.status="onLoadeddata",t.duration=e.duration,t.$emit("videoLoadeddata",e)},onLoadstart:function(){t.isWaiting=!0},onWaiting:function(){t.status="waiting",t.isWaiting=!0},onSeeking:function(){t.isSeeking=!0,t.isWaiting=!0},onSeeked:function(){t.isSeeking=!1,t.isWaiting=!1},onAutoplay:function(){t.status="autoPlay",t.isPlaying=!0,t.isPlayed=!0},onProgress:function(e){e.buffered.length>0&&(t.loadPercentage=e.buffered.end(0)/e.duration*100)},onError:function(e){console.log("onerror",e)}}),this.cssFullscreen||this.onfullscreenEvents(),this.autoPlay?this.updateMuted(!0):this.updateMuted(this.isMuted),this.video&&this.updateVolume(this.video.volume)},updateVolume(e){this.video&&(this.video.volume=e,this.volume=e)},toggleFullscreen(){if(this.cssFullscreen)this.isFullscreen=!this.isFullscreen,this.isCrossScreen&&this.$nextTick((()=>{this.initBar()}));else{if(_.isIOS())return void document.getElementById(this.vId).webkitEnterFullscreen();w.request(document.getElementById(this.vId))}},resovleParentSettedTransformCauseChirldNodeInvalidFixed(){const e=C(this.$refs["m-video-player"]);this.needtoSetParent=[],e.forEach((e=>{"none"!==e.style.transform&&(this.needtoSetParent.push({element:e,transform:e.style.transform}),e.style.transform="none")}));document.getElementById(this.vId).classList.add("m-video-player--fullScreen")},resetParentStyle(){this.needtoSetParent.forEach((e=>{e.element.style.transform=e.transform}));document.getElementById(this.vId).classList.remove("m-video-player--fullScreen")},toogleMuted(){this.video&&(this.video.muted=!this.isMuted,this.isMuted=!this.isMuted)},updateMuted(e){this.video&&(this.video.muted=e,this.isMuted=e)},clearControlTimeout(){clearTimeout(this.controlTimer),this.controlTimer=null},togglePlay(){this.video||this.initVideo(),this.video&&this.video.isPaused?(!this.isPlaysinline&&_.isAndroid()&&(setTimeout((()=>{w.request(document.getElementById(this.vId))}),500),document.getElementById(this.vId).addEventListener("x5videoexitfullscreen",(()=>{this.video.load()}))),this.video.pause(),this.video.play(),this.isPlaying=!0,this.isPlayed=!0):this.video&&(this.video.pause(),this.isPlaying=!1),this.$emit("togglePlay")},play(){this.video||this.initVideo(),this.video&&this.video.play(),this.isPlaying=!0,this.isPlayed=!0},pause(){this.video&&this.video.pause(),this.isPlaying=!1},toggleControl(){this.controls&&(this.isControl&&this.video&&!this.video.isPaused?this.isControl=!1:this.video&&this.video.isPaused?this.fixShowControl():this.showControl())},fixShowControl(){this.controls&&(this.isControl=!0,this.clearControlTimeout())},showControl(){this.controls&&(this.isControl=!0,this.controlTimer||(this.controlTimer=setTimeout((()=>{this.isControl=!1,this.clearControlTimeout()}),4e3)))},updateByPercentage(e){this.percentage=e,this.currentTime=Math.floor(this.percentage*this.duration/100)},getPercentageByTouchX(e){const t=Math.floor((e-this.barX)/this.barWidth*100);return t<=0?0:t>=100?100:t},touchstart(e){this.clearControlTimeout(),this.isSeeking=!0;const t=this.isFullscreen&&this.cssFullscreen&&this.isCrossScreen?e.touches[0].clientY:e.touches[0].clientX;this.percentage=this.getPercentageByTouchX(t),this.updateByPercentage(this.percentage),this.touchend()},touchmove(e){const t=this.isFullscreen&&this.cssFullscreen&&this.isCrossScreen?e.touches[0].clientY:e.touches[0].clientX;this.percentage=this.getPercentageByTouchX(t),this.updateByPercentage(this.percentage),this.touchend()},touchend(){this.video&&(this.video.currentTime=this.currentTime),this.showControl(),this.isSeeking=!1},click(e){const t=this.isFullscreen&&this.cssFullscreen&&this.isCrossScreen?e.clientY:e.clientX;this.percentage=this.getPercentageByTouchX(t),this.updateByPercentage(this.percentage),this.touchend()},toogleVolume(){this.isShowVolume=!this.isShowVolume},destroy(){this.video&&this.video.destroy()}}};const j=["id"],V=["src"],N=r("div",{class:"video-player__controls__playBtn"},null,-1),q={class:"video-player__controls__currentTime"},z={class:"video-player__controls__warpper__progress"},Q=r("div",{class:"progress__slot"},null,-1),H=[r("div",{class:"video-player__controls__warpper__progress__played__dot"},null,-1)],U={class:"video-player__controls__duration"},Y={class:"video-player__controls__volume"};R.render=function(e,t,s,f,b,w){const C=d("volume-control"),_=d("bottom-bar"),P=d("loading"),S=u("longpress");return o(),n("div",{ref:"m-video-player",class:c(["m-video-player",b.isFullscreen&&s.cssFullscreen&&s.isCrossScreen?"cross-screen":""]),style:l(b.isFullscreen&&s.cssFullscreen&&s.isCrossScreen?b.crossScreenStyle:"")},[r("div",{ref:"videoPlayer",style:l(b.isFullscreen&&s.cssFullscreen&&s.isCrossScreen?b.crossScreenStyle:{height:s.height,width:s.width}),class:c([b.isX5Android?b.isX5Horizontal?"x5-android--horizontal":"x5-android":"","video-player",b.isFullscreen&&s.cssFullscreen&&!s.isCrossScreen?"video-player--is-cssfullscreen":""])},[r("div",{id:"Container"+b.vId,ref:"playerContainer",class:c(["video-player__main"])},null,8,j),r("div",{class:c(["video-player__poster",{"is-playing":b.isPlayed}]),style:l({"background-image":`url(${s.poster})`})},null,6),r("div",{class:c(["video-player__bg",{"is-playing":b.isPlaying}]),onClick:t[1]||(t[1]=h(((...e)=>w.toggleControl&&w.toggleControl(...e)),["stop"]))},[r("div",{class:"video-player__bg__big-play-btn",onClick:t[0]||(t[0]=h(((...e)=>w.togglePlay&&w.togglePlay(...e)),["stop"]))},[r("img",{src:s.controlPlayBtn,class:"video-player__bg__big-play-btn__img"},null,8,V)])],2),g(e.$slots,"default"),r("div",{class:c(["video-player__controls",{"is-playing":!b.isControl}])},[N,r("div",q,p(b.currentTime|e.timeFormatter),1),r("div",{ref:"progress",class:"video-player__controls__warpper",onTouchstart:t[2]||(t[2]=(...e)=>w.touchstart&&w.touchstart(...e)),onTouchmove:t[3]||(t[3]=(...e)=>w.touchmove&&w.touchmove(...e)),onTouchend:t[4]||(t[4]=(...e)=>w.touchend&&w.touchend(...e)),onClick:t[5]||(t[5]=(...e)=>w.click&&w.click(...e))},[r("div",z,[r("div",{class:"video-player__controls__warpper__progress__load",style:l({width:`${b.loadPercentage}%`})},null,4),Q,r("div",{class:"video-player__controls__warpper__progress__played",style:l({width:`${b.percentage}%`,background:`${s.themeColor}`})},H,4)])],544),r("div",U,p(b.duration|e.timeFormatter),1),i(r("section",Y,[r("div",{class:c(["video-player__controls__volume__icon",b.isMuted?"muted":""]),onClick:t[6]||(t[6]=(...e)=>w.toogleMuted&&w.toogleMuted(...e))},null,2),v(C,{"is-show":b.isShowVolume,volume:b.volume,"is-fullscreen":b.isFullscreen,"css-fullscreen":s.cssFullscreen,"is-cross-screen":s.isCrossScreen},null,8,["is-show","volume","is-fullscreen","css-fullscreen","is-cross-screen"])],512),[[S,w.toogleVolume]]),r("div",{class:c(["video-player__controls__fullscreen",b.isFullscreen&&s.cssFullscreen?"small":""]),onClick:t[7]||(t[7]=(...e)=>w.toggleFullscreen&&w.toggleFullscreen(...e))},null,2)],2),s.isBottomBar?(o(),m(_,{key:0,percentage:b.percentage,"load-percentage":b.loadPercentage,"theme-color":s.themeColor,"is-show":!b.isControl&&!b.isFirstPlayed},null,8,["percentage","load-percentage","theme-color","is-show"])):y("v-if",!0),i(v(P,{color:s.themeColor},null,8,["color"]),[[a,b.isWaiting]]),y(' <div class="video-player__water-mark"></div> ')],6)],6)},R.__file="src/player.vue";const D=function(e){e.component(R.name,R)},J={videoPlayer:R,install:D};export{J as default,D as install,R as videoPlayer};
